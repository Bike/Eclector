\chapter{External protocols}

\section{Packages}

\subsection{Package for ordinary reader features}

The package for ordinary reader features is named
\texttt{eclector.reader}.  To use features of this package, we
recommend the use of explicit package prefixes, simply because this
package shadows and exports names that are also exported from the
\texttt{common-lisp} package.  Importing this package will likely
cause conflicts with the \texttt{common-lisp} package otherwise.

\subsection{Package for readtable features}

The package for readtable-related features is named
\texttt{eclector.readertable}.  To use features of this package, we
recommend the use of explicit package prefixes, simply because this
package shadows and exports names that are also exported from the
\texttt{common-lisp} package.  Importing this package will likely
cause conflicts with the \texttt{common-lisp} package otherwise.

\subsection{Package for CST features}

The package for features related to concrete syntax trees is named
eclector.concrete-syntax-tree.  Although this package does not shadow
any symbol in the \texttt{common-lisp} package, we still recommend the
use of explicit package prefixes to refer to symbols in this package.

\section{Ordinary reader features}

\Defun {read} {\optional (input-stream \texttt{*standard-input*})\\
  (eof-error-p \texttt{t})
  (eof-value \texttt{nil})
  (recursive-p \texttt{nil})}

This function is the main entry point for the ordinary reader.  It is
entirely compatible with the standard \commonlisp{} function with the
same name.

\Defvar {*client*}

This variable is used by several generic functions called by
\texttt{read}.  The default value of the variable is \texttt{nil}.
Client code that wants to override or extend the default behavior of
some generic function of \sysname{} should bind this variable to some
standard object and provide a method on that generic function,
specialized to the class of that standard object.

\Defgeneric {read-common} {client input-stream eof-error-p eof-value}

This generic function is called by \texttt{read}, passing it the value
of the variable \texttt{*client*} and the corresponding parameters.
Client code can add methods on this function, specializing them to the
client class of their choice.  The actions that \texttt{read} need to
take for different values of the parameter \texttt{recursive-p} have
already been taken before \texttt{read} calls this generic function.
